<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant POS | Scan to Pay</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script src="easypayio-gateway.js"></script>
    
    <style>
        :root {
            --primary: #0f172a;
            --gold: #b45309;
            --success: #059669;
        }
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .pos-display {
            background: white;
            color: var(--primary);
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 5px solid var(--gold);
            max-width: 400px;
            width: 100%;
        }
        h1 {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
            margin-top: 0;
            font-size: 2.2rem;
        }
        .price-tag {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--primary);
        }
        #qrcode {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            border: 2px dashed #cbd5e1;
        }
        /* Step 2: Add a button style for the Gateway */
        .gateway-btn {
            background: var(--gold);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            font-size: 1rem;
            transition: 0.3s;
            margin-top: 15px;
        }
        .gateway-btn:hover {
            background: #92400e;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>

    <div class="pos-display">
        <h1>Arabian Nights</h1>
        <p>Scan to pay with UPI or use the secure gateway below</p>
        
        <div class="price-tag" id="display-amount">₹0</div>
        
        <div id="qrcode"></div>
        
        <button class="gateway-btn" onclick="openEasyPay()">Pay Securely Online</button>
        
        <div style="margin-top: 20px; font-size: 0.85rem; color: #94a3b8;">
            Accepted: UPI, Cards, NetBanking
        </div>
    </div>

    <script>
        // Retrieve amount from URL (e.g., generate-qr.html?amount=480)
        const urlParams = new URLSearchParams(window.location.search);
        const amount = urlParams.get('amount') || "0";
        document.getElementById('display-amount').innerText = "₹" + amount;

        // Generate the UPI QR Code
        const paymentString = `upi://pay?pa=arabiannights@easypayio&pn=Arabian%20Nights&am=${amount}&cu=INR`;
        new QRCode(document.getElementById("qrcode"), {
            text: paymentString,
            width: 200,
            height: 200,
            colorDark : "#020617",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });

        // Step 4: Function to trigger the Gateway logic from easypayio-gateway.js
        function openEasyPay() {
            if (typeof EasyPayIO !== 'undefined') {
                EasyPayIO.pay({
                    amount: amount,
                    productName: "Arabian Nights Feast",
                    onSuccess: function(response) {
                        alert("Payment Successful! Transaction ID: " + response.transactionId);
                        // Optional: Redirect to a thank you page
                    },
                    onFailure: function(error) {
                        console.error("Payment Failed", error);
                        alert("Payment could not be completed.");
                    }
                });
            } else {
                alert("Payment Gateway is still loading. Please try again in a moment.");
            }
        }
    </script>

</body>
</html>
