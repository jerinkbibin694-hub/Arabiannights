<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order QR Code - Arabian Nights</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <!-- Easy PayIO Gateway SDK -->
    <script src="easypayio-gateway.js"></script>
    <style>
        :root {
            --primary: #0f172a;
            --gold: #b45309;
            --cream: #fffbeb;
            --glass: rgba(255, 255, 255, 0.98);
            --dark: #020617;
            --success: #059669;
            --error: #dc2626;
            --info: #3b82f6;
            --warning: #d97706;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background: #020617 url('https://images.unsplash.com/photo-1541123638404-61aa0dd9a9c5?q=80&w=2000') no-repeat center center fixed;
            background-size: cover;
            color: #1e293b;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(to bottom, rgba(2, 6, 23, 0.92), rgba(2, 6, 23, 0.7));
            color: var(--cream);
            border-bottom: 5px solid var(--gold);
        }

        header h1 { font-family: 'Playfair Display', serif; font-size: 2.5rem; margin: 0; letter-spacing: 3px; text-transform: uppercase; }

        .container {
            max-width: 1000px;
            margin: 30px auto 50px;
            background: var(--glass);
            border-radius: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            padding: 30px;
        }

        /* QR Code Page Styles */
        .qr-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
            flex-wrap: wrap;
            gap: 15px;
        }

        .qr-header h2 {
            font-family: 'Playfair Display', serif;
            margin: 0;
            color: var(--primary);
        }

        .order-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .order-selector select {
            padding: 12px 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            font-family: 'Poppins', sans-serif;
            min-width: 250px;
            background: white;
        }

        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: var(--gold);
            transform: rotate(180deg);
        }

        .qr-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .qr-main {
                grid-template-columns: 1fr;
            }
        }

        .qr-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #f1f5f9;
            text-align: center;
        }

        .qr-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .qr-title i {
            color: var(--gold);
            margin-right: 8px;
        }

        #qrcode-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            margin: 20px 0;
            border: 2px dashed #e2e8f0;
        }

        #qrcode-container canvas, #qrcode-container img {
            width: 250px !important;
            height: 250px !important;
        }

        .order-details-mini {
            text-align: left;
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #64748b;
            font-weight: 500;
        }

        .detail-value {
            font-weight: 600;
            color: var(--primary);
        }

        .payment-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .payment-badge.upi {
            background: #dbeafe;
            color: var(--info);
        }

        .payment-badge.cash {
            background: #fef3c7;
            color: var(--warning);
        }

        .payment-badge.paid {
            background: #d1fae5;
            color: var(--success);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn:hover {
            background: var(--gold);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #047857;
        }

        .recent-orders {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .recent-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
        }

        .order-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .order-item-card {
            padding: 15px;
            border: 1px solid #f1f5f9;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .order-item-card:hover {
            border-color: var(--gold);
            background: #fffcf0;
            transform: translateX(5px);
        }

        .order-item-card.selected {
            border-color: var(--gold);
            border-width: 2px;
            background: #fffcf0;
        }

        .order-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .order-number {
            font-weight: 700;
            color: var(--gold);
            font-size: 1.1rem;
        }

        .order-time {
            font-size: 0.8rem;
            color: #64748b;
        }

        .order-customer {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #475569;
        }

        .order-amount {
            font-weight: 700;
            color: var(--primary);
        }

        .payment-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }

        .payment-indicator.upi {
            background: var(--info);
        }

        .payment-indicator.cash {
            background: var(--warning);
        }

        .payment-indicator.paid {
            background: var(--success);
        }

        .no-orders {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }

        .no-orders i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .print-section {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
        }

        .print-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
        }

        .print-btn:hover {
            background: var(--gold);
        }

        .kitchen-note {
            background: #fef3c7;
            border-left: 4px solid var(--gold);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 0.95rem;
        }

        .kitchen-note i {
            color: var(--gold);
            margin-right: 8px;
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            header, .qr-header, .recent-orders, .action-buttons, .print-section, .refresh-btn, .kitchen-note {
                display: none;
            }
            .container {
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }
            .qr-main {
                grid-template-columns: 1fr;
            }
            .qr-card {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
            #qrcode-container canvas {
                width: 200px !important;
                height: 200px !important;
            }
        }
    </style>
</head>
<body>

<header>
    <h1>ARABIAN NIGHTS</h1>
    <p>ORDER QR CODE GENERATOR</p>
</header>

<div class="container">
    <div class="qr-header">
        <h2>üì± Order QR Codes</h2>
        <div class="order-selector">
            <select id="orderSelect" onchange="loadSelectedOrder()">
                <option value="">Select an order...</option>
            </select>
            <button class="refresh-btn" onclick="loadOrders()" title="Refresh Orders">‚Üª</button>
        </div>
    </div>

    <div class="kitchen-note">
        <i>‚ÑπÔ∏è</i> <strong>Kitchen Staff:</strong> Scan QR code to view complete order details. Each QR code is unique to the order and payment method.
    </div>

    <div class="qr-main">
        <!-- Left side - QR Code Display -->
        <div class="qr-card">
            <div class="qr-title">
                <i>üî≥</i> Order QR Code
            </div>
            
            <div id="qrcode-container">
                <!-- QR code will be generated here -->
                <div style="padding: 40px; color: #94a3b8; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üìå</div>
                    <p>Select an order to generate QR code</p>
                </div>
            </div>

            <div id="orderDetails" class="order-details-mini" style="display: none;">
                <!-- Order details will be populated here -->
            </div>

            <div class="action-buttons" id="qrActions" style="display: none;">
                <button class="btn btn-outline" onclick="downloadQRCode()">
                    ‚¨áÔ∏è Download QR
                </button>
                <button class="btn btn-success" onclick="printQRCode()">
                    üñ®Ô∏è Print QR
                </button>
            </div>
        </div>

        <!-- Right side - Recent Orders List -->
        <div class="recent-orders">
            <div class="recent-title">
                <i>üìã</i> Recent Orders
                <span id="orderCount" style="margin-left: auto; background: #f1f5f9; padding: 3px 10px; border-radius: 20px; font-size: 0.85rem;">0</span>
            </div>
            
            <div id="orderList" class="order-list">
                <div class="no-orders">
                    <div>üì≠</div>
                    <p>No orders found</p>
                    <small>Orders placed through Easy PayIO will appear here</small>
                </div>
            </div>

            <div class="print-section">
                <button class="print-btn" onclick="window.print()">
                    üñ®Ô∏è Print All Visible
                </button>
                <p style="font-size: 0.8rem; color: #64748b; margin-top: 10px;">
                    Use print to generate kitchen order tickets
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Order Details Modal (hidden by default) -->
<div id="orderDetailsModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; box-shadow: 0 30px 60px rgba(0,0,0,0.3); z-index: 1000; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
    <!-- Modal content will be populated dynamically -->
</div>

<div id="modalOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999;" onclick="closeModal()"></div>

<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAzg6lEGVS-hcedC7ZhWdz0uq1_vtqTCCA",
        authDomain: "arabian-nights-cca24.firebaseapp.com",
        databaseURL: "https://arabian-nights-cca24-default-rtdb.firebaseio.com",
        projectId: "arabian-nights-cca24",
        storageBucket: "arabian-nights-cca24.firebasestorage.app",
        messagingSenderId: "405951495752",
        appId: "1:405951495752:web:cedcf446717f9359b2e27d",
        measurementId: "G-N6ZC0F2J5V"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let currentOrders = [];
    let selectedOrderId = null;
    let currentQRCode = null;

    // Load orders when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadOrders();
        
        // Listen for new orders in real-time
        database.ref('orders').orderByChild('timestamp').limitToLast(20).on('value', (snapshot) => {
            loadOrders();
        });
    });

    function loadOrders() {
        database.ref('orders').orderByChild('timestamp').limitToLast(20).once('value', (snapshot) => {
            const orders = [];
            snapshot.forEach((childSnapshot) => {
                orders.push({
                    id: childSnapshot.key,
                    ...childSnapshot.val()
                });
            });
            
            // Sort by timestamp descending (newest first)
            orders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            currentOrders = orders;
            
            updateOrderList(orders);
            updateOrderSelect(orders);
            
            // If there was a previously selected order, try to select it again
            if (selectedOrderId) {
                const select = document.getElementById('orderSelect');
                if (select.querySelector(`option[value="${selectedOrderId}"]`)) {
                    select.value = selectedOrderId;
                    loadSelectedOrder();
                } else {
                    selectedOrderId = null;
                }
            }
        });
    }

    function updateOrderList(orders) {
        const orderList = document.getElementById('orderList');
        const orderCount = document.getElementById('orderCount');
        
        orderCount.textContent = orders.length;
        
        if (orders.length === 0) {
            orderList.innerHTML = `
                <div class="no-orders">
                    <div>üì≠</div>
                    <p>No orders found</p>
                    <small>Orders placed through Easy PayIO will appear here</small>
                </div>
            `;
            return;
        }
        
        let html = '';
        orders.forEach(order => {
            const date = new Date(order.timestamp);
            const timeStr = date.toLocaleTimeString();
            const dateStr = date.toLocaleDateString();
            
            // Determine payment indicator color
            let paymentIndicator = 'cash';
            if (order.paymentMethod?.includes('UPI') || order.paymentStatus === 'Paid') {
                paymentIndicator = order.paymentStatus === 'Paid' ? 'paid' : 'upi';
            }
            
            html += `
                <div class="order-item-card ${selectedOrderId === order.id ? 'selected' : ''}" 
                     onclick="selectOrder('${order.id}')">
                    <div class="order-item-header">
                        <span class="order-number">#${order.orderNumber || order.id.slice(-4)}</span>
                        <span class="order-time">${timeStr}</span>
                    </div>
                    <div class="order-customer">
                        <span>
                            <span class="payment-indicator ${paymentIndicator}"></span>
                            ${order.name || 'Guest'} (Table ${order.table || 'Takeaway'})
                        </span>
                        <span class="order-amount">${order.total || '‚Çπ0'}</span>
                    </div>
                    <div style="font-size: 0.8rem; color: #64748b; margin-top: 5px;">
                        ${order.items?.length || 0} items ‚Ä¢ ${order.paymentMethod || 'Payment pending'}
                    </div>
                </div>
            `;
        });
        
        orderList.innerHTML = html;
    }

    function updateOrderSelect(orders) {
        const select = document.getElementById('orderSelect');
        let options = '<option value="">Select an order...</option>';
        
        orders.forEach(order => {
            const date = new Date(order.timestamp);
            const timeStr = date.toLocaleTimeString();
            options += `<option value="${order.id}">#${order.orderNumber || order.id.slice(-4)} - ${order.name || 'Guest'} (${timeStr}) - ${order.total || '‚Çπ0'}</option>`;
        });
        
        select.innerHTML = options;
    }

    function selectOrder(orderId) {
        selectedOrderId = orderId;
        const select = document.getElementById('orderSelect');
        select.value = orderId;
        loadSelectedOrder();
        
        // Update selected state in list
        document.querySelectorAll('.order-item-card').forEach(card => {
            card.classList.remove('selected');
        });
        const selectedCard = document.querySelector(`[onclick="selectOrder('${orderId}')"]`);
        if (selectedCard) {
            selectedCard.classList.add('selected');
        }
    }

    function loadSelectedOrder() {
        const select = document.getElementById('orderSelect');
        const orderId = select.value;
        
        if (!orderId) {
            document.getElementById('qrcode-container').innerHTML = `
                <div style="padding: 40px; color: #94a3b8; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üìå</div>
                    <p>Select an order to generate QR code</p>
                </div>
            `;
            document.getElementById('orderDetails').style.display = 'none';
            document.getElementById('qrActions').style.display = 'none';
            return;
        }
        
        selectedOrderId = orderId;
        const order = currentOrders.find(o => o.id === orderId);
        
        if (order) {
            generateQRCode(order);
            displayOrderDetails(order);
        }
    }

    function generateQRCode(order) {
        const container = document.getElementById('qrcode-container');
        container.innerHTML = ''; // Clear previous QR code
        
        // Create QR code data - includes all relevant order information
        const qrData = {
            orderId: order.id,
            orderNumber: order.orderNumber,
            customer: order.name,
            table: order.table,
            total: order.total,
            totalAmount: order.totalAmount,
            paymentMethod: order.paymentMethod,
            paymentStatus: order.paymentStatus,
            timestamp: order.timestamp,
            items: order.items.map(item => ({
                name: item.name,
                quantity: item.quantity,
                price: item.price
            }))
        };
        
        // Convert to JSON string for QR code
        const qrString = JSON.stringify(qrData, null, 2);
        
        // Generate QR code
        QRCode.toCanvas(document.createElement('canvas'), qrString, {
            width: 250,
            margin: 2,
            color: {
                dark: '#0f172a',
                light: '#ffffff'
            }
        }, function(err, canvas) {
            if (err) {
                console.error(err);
                container.innerHTML = '<p style="color: var(--error);">Error generating QR code</p>';
                return;
            }
            
            // Add logo or styling to canvas
            const finalCanvas = document.createElement('canvas');
            finalCanvas.width = 250;
            finalCanvas.height = 250;
            const ctx = finalCanvas.getContext('2d');
            
            // Draw white background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 250, 250);
            
            // Draw the QR code in the center
            ctx.drawImage(canvas, 0, 0, 250, 250);
            
            // Add a small Arabian Nights logo overlay (optional)
            ctx.fillStyle = 'rgba(180, 83, 9, 0.1)';
            ctx.beginPath();
            ctx.arc(125, 125, 30, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.font = 'bold 10px Poppins';
            ctx.fillStyle = '#b45309';
            ctx.textAlign = 'center';
            ctx.fillText('AN', 125, 130);
            
            container.appendChild(finalCanvas);
            currentQRCode = finalCanvas;
        });
        
        // Also generate a data URL for download
        QRCode.toDataURL(qrString, {
            width: 300,
            margin: 2
        }, function(err, url) {
            if (!err) {
                currentQRCode = url;
            }
        });
    }

    function displayOrderDetails(order) {
        const detailsDiv = document.getElementById('orderDetails');
        const actionsDiv = document.getElementById('qrActions');
        
        const date = new Date(order.timestamp);
        const dateStr = date.toLocaleString();
        
        // Generate items list
        let itemsHtml = '';
        if (order.items && order.items.length > 0) {
            itemsHtml = '<div style="margin-top: 15px;"><strong>Items:</strong></div>';
            order.items.forEach(item => {
                itemsHtml += `
                    <div class="detail-row" style="font-size: 0.9rem;">
                        <span>${item.name} x${item.quantity}</span>
                        <span>‚Çπ${item.price * item.quantity}</span>
                    </div>
                `;
            });
        }
        
        // Determine payment badge class
        let paymentBadgeClass = 'payment-badge';
        if (order.paymentMethod?.includes('UPI') || order.paymentStatus === 'Paid') {
            paymentBadgeClass += order.paymentStatus === 'Paid' ? ' paid' : ' upi';
        } else {
            paymentBadgeClass += ' cash';
        }
        
        detailsDiv.innerHTML = `
            <div style="margin-bottom: 15px; text-align: center;">
                <span class="${paymentBadgeClass}">
                    ${order.paymentMethod || 'Payment: ' + order.paymentStatus}
                </span>
            </div>
            
            <div class="detail-row">
                <span class="detail-label">Order #</span>
                <span class="detail-value">${order.orderNumber || order.id.slice(-4)}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Customer</span>
                <span class="detail-value">${order.name || 'Guest'}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Table</span>
                <span class="detail-value">${order.table || 'Takeaway'}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Date/Time</span>
                <span class="detail-value">${dateStr}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Total Amount</span>
                <span class="detail-value" style="color: var(--gold);">${order.total || '‚Çπ' + order.totalAmount}</span>
            </div>
            ${itemsHtml}
            <div style="margin-top: 15px; font-size: 0.85rem; color: #64748b; text-align: center;">
                Scan QR to view full order details
            </div>
        `;
        
        detailsDiv.style.display = 'block';
        actionsDiv.style.display = 'flex';
    }

    function downloadQRCode() {
        if (!currentQRCode || !selectedOrderId) {
            alert('Please select an order first');
            return;
        }
        
        const order = currentOrders.find(o => o.id === selectedOrderId);
        const orderNumber = order?.orderNumber || selectedOrderId.slice(-4);
        
        // Create download link
        const link = document.createElement('a');
        
        if (typeof currentQRCode === 'string') {
            // If we have a data URL
            link.href = currentQRCode;
        } else {
            // If we have a canvas
            link.href = currentQRCode.toDataURL('image/png');
        }
        
        link.download = `arabian-nights-order-${orderNumber}.png`;
        link.click();
    }

    function printQRCode() {
        if (!selectedOrderId) {
            alert('Please select an order first');
            return;
        }
        
        // Open print-friendly view
        const order = currentOrders.find(o => o.id === selectedOrderId);
        const printWindow = window.open('', '_blank');
        
        printWindow.document.write(`
            <html>
            <head>
                <title>Order #${order?.orderNumber || selectedOrderId.slice(-4)} - QR Code</title>
                <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
                <style>
                    body { font-family: 'Poppins', sans-serif; padding: 30px; text-align: center; }
                    .qr-container { margin: 30px auto; max-width: 300px; }
                    img { width: 100%; height: auto; }
                    .order-details { margin-top: 20px; text-align: left; max-width: 400px; margin: 20px auto; }
                    .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
                    h2 { color: #b45309; }
                    @media print {
                        body { padding: 15px; }
                        button { display: none; }
                    }
                </style>
            </head>
            <body>
                <h2>ARABIAN NIGHTS</h2>
                <h3>Order #${order?.orderNumber || selectedOrderId.slice(-4)}</h3>
                <div class="qr-container">
                    <img src="${typeof currentQRCode === 'string' ? currentQRCode : currentQRCode.toDataURL()}" alt="Order QR Code">
                </div>
                <div class="order-details">
                    <div class="detail-row"><span>Customer:</span> <strong>${order?.name || 'Guest'}</strong></div>
                    <div class="detail-row"><span>Table:</span> <strong>${order?.table || 'Takeaway'}</strong></div>
                    <div class="detail-row"><span>Total:</span> <strong>${order?.total || '‚Çπ' + order?.totalAmount}</strong></div>
                    <div class="detail-row"><span>Payment:</span> <strong>${order?.paymentMethod || order?.paymentStatus}</strong></div>
                </div>
                <button onclick="window.print()" style="margin-top: 30px; padding: 10px 30px; background: #b45309; color: white; border: none; border-radius: 5px; cursor: pointer;">Print QR Code</button>
            </body>
            </html>
        `);
        
        printWindow.document.close();
    }

    function viewOrderDetails(orderId) {
        const order = currentOrders.find(o => o.id === orderId);
        if (!order) return;
        
        const modal = document.getElementById('orderDetailsModal');
        const overlay = document.getElementById('modalOverlay');
        
        let itemsHtml = '';
        order.items.forEach(item => {
            itemsHtml += `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>‚Çπ${item.price}</td>
                    <td>‚Çπ${item.price * item.quantity}</td>
                </tr>
            `;
        });
        
        modal.innerHTML = `
            <h3 style="font-family: 'Playfair Display'; margin-top: 0; color: var(--gold);">Order #${order.orderNumber || order.id.slice(-4)}</h3>
            
            <div style="margin-bottom: 20px;">
                <p><strong>Customer:</strong> ${order.name || 'Guest'} (Table ${order.table || 'Takeaway'})</p>
                <p><strong>Time:</strong> ${new Date(order.timestamp).toLocaleString()}</p>
                <p><strong>Payment:</strong> ${order.paymentMethod || 'Not specified'} - ${order.paymentStatus}</p>
            </div>
            
            <h4>Items</h4>
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                <thead>
                    <tr style="background: #f1f5f9;">
                        <th style="padding: 10px; text-align: left;">Item</th>
                        <th style="padding: 10px;">Qty</th>
                        <th style="padding: 10px;">Price</th>
                        <th style="padding: 10px;">Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    ${itemsHtml}
                </tbody>
                <tfoot>
                    <tr style="font-weight: 700; border-top: 2px solid #e2e8f0;">
                        <td colspan="3" style="padding: 10px; text-align: right;">Total:</td>
                        <td style="padding: 10px; color: var(--gold);">${order.total || '‚Çπ' + order.totalAmount}</td>
                    </tr>
                </tfoot>
            </table>
            
            <button onclick="closeModal()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; width: 100%;">Close</button>
        `;
        
        modal.style.display = 'block';
        overlay.style.display = 'block';
    }

    function closeModal() {
        document.getElementById('orderDetailsModal').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // Make functions globally available
    window.loadOrders = loadOrders;
    window.loadSelectedOrder = loadSelectedOrder;
    window.selectOrder = selectOrder;
    window.downloadQRCode = downloadQRCode;
    window.printQRCode = printQRCode;
    window.viewOrderDetails = viewOrderDetails;
    window.closeModal = closeModal;
</script>

<!-- Add this to your home.html to link to QR page -->
<div style="position: fixed; bottom: 30px; left: 30px; z-index: 1000;">
    <button onclick="window.location.href='qr-page.html'" style="background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 50px; cursor: pointer; font-weight: 600; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 8px;">
        üì± QR Code Page
    </button>
</div>

<!-- Add this script to home.html to enable navigation -->
<script>
    // Add this to your home.html script section to enable QR page navigation
    function goToQRPage() {
        window.location.href = 'qr-page.html';
    }
</script>

</body>
</html>
