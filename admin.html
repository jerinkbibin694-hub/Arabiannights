<!DOCTYPE html>
<html>
<head>
<title>Admin Panel - Arabian Nights</title>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#111;
    color:white;
    padding:30px;
}

h1{
    color:#FFD700;
    text-align:center;
}

.logout-btn{
    position:absolute;
    top:20px;
    right:30px;
    background:#FFD700;
    border:none;
    padding:8px 15px;
    font-weight:bold;
    cursor:pointer;
}

.section{
    background:#1c1c1c;
    padding:20px;
    margin:20px 0;
    border-radius:15px;
}

.card{
    background:#222;
    padding:15px;
    margin:10px 0;
    border-radius:10px;
    border-left: 4px solid #FFD700;
}

.status-badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
}

.status-pending { background: #b45309; color: white; }
.status-preparing { background: #2563eb; color: white; }
.status-ready { background: #059669; color: white; }

.refresh-note {
    text-align: center;
    color: #059669;
    font-size: 12px;
    margin-top: 20px;
}
</style>
</head>
<body>

<button class="logout-btn" onclick="logout()">Logout</button>

<h1>Arabian Nights Admin Panel</h1>

<div class="section">
<h2>ðŸ“… Table Bookings</h2>
<div id="bookingList">Loading bookings...</div>
</div>

<div class="section">
<h2>ðŸ›’ Menu Orders</h2>
<div id="orderList">Loading orders...</div>
</div>

<div class="refresh-note">ðŸŸ¢ Connected to live database updates</div>

<script>
// STRICT PROTECTION
if(sessionStorage.getItem("adminLoggedIn") !== "true"){
    window.location.replace("admin-login.html"); // Check filename consistency
}

function logout(){
    sessionStorage.removeItem("adminLoggedIn");
    window.location.replace("adminlogin.html");
}

// Initialize Firebase
const firebaseConfig = {
    apiKey: "AIzaSyAzg6lEGVS-hcedC7ZhWdz0uq1_vtqTCCA",
    authDomain: "arabian-nights-cca24.firebaseapp.com",
    databaseURL: "https://arabian-nights-cca24-default-rtdb.firebaseio.com",
    projectId: "arabian-nights-cca24",
    storageBucket: "arabian-nights-cca24.firebasestorage.app",
    messagingSenderId: "405951495752",
    appId: "1:405951495752:web:cedcf446717f9359b2e27d",
    measurementId: "G-N6ZC0F2J5V"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Real-time listener for Bookings
database.ref('bookings').on('value', (snapshot) => {
    let bookingList = document.getElementById("bookingList");
    bookingList.innerHTML = "";
    
    if(!snapshot.exists()){
        bookingList.innerHTML = "No bookings yet.";
        return;
    }

    snapshot.forEach((childSnapshot) => {
        let b = childSnapshot.val();
        bookingList.innerHTML += `
        <div class="card">
            <strong>Name:</strong> ${b.name}<br>
            <strong>Mobile:</strong> ${b.mobile}<br>
            <strong>Date:</strong> ${b.date}<br>
            <strong>Time:</strong> ${b.time}<br>
            <strong>Guests:</strong> ${b.guests}
        </div>
        `;
    });
});

// Real-time listener for Orders
database.ref('orders').on('value', (snapshot) => {
    let orderList = document.getElementById("orderList");
    orderList.innerHTML = "";
    
    if(!snapshot.exists()){
        orderList.innerHTML = "No orders yet.";
        return;
    }

    let orders = [];
    snapshot.forEach(child => orders.push(child.val()));

    // Sort: Pending -> Preparing -> Ready
    orders.sort((a, b) => {
        const statusOrder = { "Pending": 1, "Preparing": 2, "Ready": 3 };
        return (statusOrder[a.status] || 4) - (statusOrder[b.status] || 4);
    });

    orders.forEach((o) => {
        let itemsHTML = "";
        let statusClass = "status-pending";
        if(o.status === "Preparing") statusClass = "status-preparing";
        if(o.status === "Ready") statusClass = "status-ready";
        
        o.items.forEach(item => {
            itemsHTML += `${item.name} x${item.quantity} - â‚¹${item.price * item.quantity}<br>`;
        });

        orderList.innerHTML += `
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong>Order #${o.id.toString().slice(-6)}</strong>
                <span class="status-badge ${statusClass}">${o.status || "Pending"}</span>
            </div>
            <strong>Customer:</strong> ${o.name}<br>
            <strong>Table:</strong> ${o.table}<br>
            <strong>Time:</strong> ${new Date(o.timestamp).toLocaleTimeString()}<br>
            <strong>Total:</strong> ${o.total}<br>
            <strong>Payment:</strong> ${o.paymentMethod || "N/A"}<br>
            <strong>Items:</strong><br>
            ${itemsHTML}
        </div>
        `;
    });
});
</script>

</body>
</html>